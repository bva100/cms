function getPublicMediaUrl(){var abbrHostname=getAbbrHostname();switch(abbrHostname){case"dev":case"localhost":default:return"http://d10nuh33ml191h.cloudfront.net/";break}}function getAbbrHostname(){switch(window.location.hostname){case"pipestack.com":return"prod";case"dev.pipestack.com":return"dev";case"localhost":case"127.0.0.1":return"localhost";break;default:return"";break}}
var filepickerKey="AMPdbi1aZQuuzMBLLznNWz";function convertInkToMediaParams(ink,siteId,nodeId){mediaParams={};mediaParams.filename=ink.key;mediaParams.storage="S3";mediaParams.url=ink.url;mediaParams.mime=ink.mimetype;mediaParams.size=ink.size;mediaParams.siteId=siteId;if(nodeId){mediaParams.nodeId=nodeId}return mediaParams}
var siteId=document.getElementById("site-id").value;var mediaAddPath=document.getElementById("media-add-path").value;$(document).ready(function(){filepicker.setKey(filepickerKey);uploader()});function uploader(){filepicker.pickAndStore({container:"media-uploader"},{location:"S3",access:"public"},function(InkBlobs){var mediaParams=convertInkToMediaParams(InkBlobs[0],siteId);mediaParams.url=getPublicMediaUrl()+mediaParams.filename;$.post(mediaAddPath,mediaParams,function(data,textStatus,xhr){if(textStatus=="success"){var mediaUploadComplete=document.getElementById("media-upload-complete");mediaUploadComplete.className="row-fluid";var mediaList=document.getElementById("media-list");mediaList.className="";var li=document.createElement("li");li.setAttribute("class","media-item row-fluid");li.innerHTML="<img src='"+mediaParams.url+"' class='span3' /><div class='span7'><h4>"+mediaParams.url+"</h4><p>"+mediaParams.mime+"</p></div>";mediaList.appendChild(li);uploader()}else{alert("Upload failed. Please try again")}})})}